<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hva forteller kroppen din? â€“ DBT VerktÃ¸y</title>

    <style>
        /* â”€â”€ Design Tokens â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        :root {
            --teal:       #4a7c84;
            --teal-deep:  #2d5159;
            --teal-light: #e2eff1;
            --sage:       #7a9e88;
            --warm:       #f5f0eb;
            --white:      #ffffff;
            --text:       #2b3033;
            --muted:      #6b7b82;
            --border:     #d4e0e3;
            --danger:     #b0444a;
            --radius:     12px;
            --shadow:     0 2px 20px rgba(0,0,0,.07);
            --transition: 220ms ease;

            /* Emotion palette */
            --col-frykt:   #6b8fc7;
            --col-sinne:   #c9654a;
            --col-tristhet:#7d9fc9;
            --col-skam:    #9b6fa8;
            --col-avsky:   #7eaa76;
            --col-glede:   #d4a74a;
        }

        *, *::before, *::after { box-sizing: border-box; }

        /* â”€â”€ Disclaimer overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #disclaimer-overlay {
            position: fixed;
            inset: 0;
            background: rgba(27, 38, 42, 0.72);
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            animation: fadeInOverlay .3s ease;
        }
        #disclaimer-overlay.hidden {
            display: none;
        }
        @keyframes fadeInOverlay {
            from { opacity: 0; }
            to   { opacity: 1; }
        }

        .disclaimer-card {
            background: var(--white);
            border-radius: 16px;
            max-width: 520px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,.25);
            overflow: hidden;
            animation: slideUpCard .35s cubic-bezier(.22,1,.36,1);
        }
        @keyframes slideUpCard {
            from { opacity: 0; transform: translateY(24px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        .disclaimer-top {
            background: linear-gradient(135deg, var(--teal-deep) 0%, #1e373d 100%);
            padding: 28px 28px 22px;
            color: white;
        }
        .disclaimer-top .disclaimer-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }
        .disclaimer-top h2 {
            font-family: Georgia, 'Palatino Linotype', Palatino, 'Book Antiqua', serif;
            font-size: 1.4rem;
            margin: 0 0 6px;
            font-weight: 400;
        }
        .disclaimer-top .subtitle {
            font-size: .85rem;
            opacity: .8;
            margin: 0;
            font-weight: 300;
        }

        .disclaimer-body {
            padding: 24px 28px;
        }

        .disclaimer-alert {
            background: #fff5f5;
            border: 2px solid #e8a0a4;
            border-radius: 10px;
            padding: 14px 16px;
            margin-bottom: 20px;
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }
        .disclaimer-alert .alert-icon {
            font-size: 1.3rem;
            flex-shrink: 0;
            margin-top: 1px;
        }
        .disclaimer-alert p {
            margin: 0;
            font-size: .88rem;
            color: #7a2428;
            line-height: 1.55;
        }
        .disclaimer-alert strong {
            display: block;
            margin-bottom: 4px;
            font-size: .9rem;
        }

        .disclaimer-points {
            list-style: none;
            padding: 0;
            margin: 0 0 24px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .disclaimer-points li {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            font-size: .88rem;
            color: var(--text);
            line-height: 1.5;
        }
        .disclaimer-points li .dp-icon {
            font-size: 1rem;
            flex-shrink: 0;
            margin-top: 1px;
        }

        .disclaimer-confirm {
            display: block;
            width: 100%;
            background: var(--teal-deep);
            color: white;
            border: none;
            padding: 15px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            font-size: .95rem;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: background var(--transition), transform var(--transition);
            letter-spacing: .01em;
        }
        .disclaimer-confirm:hover { background: #1a2e33; }
        .disclaimer-confirm:active { transform: scale(0.99); }
        .disclaimer-confirm:focus-visible { outline: 3px solid var(--teal); outline-offset: 3px; }

        .disclaimer-footer {
            text-align: center;
            font-size: .75rem;
            color: var(--muted);
            margin-top: 12px;
        }

        /* When overlay is up, lock scroll */
        body.overlay-open {
            overflow: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--warm);
            color: var(--text);
            margin: 0;
            padding: 20px 16px 60px;
            line-height: 1.65;
            min-height: 100vh;
        }

        .container {
            max-width: 640px;
            margin: 0 auto;
        }

        /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .app-header {
            text-align: center;
            margin-bottom: 28px;
        }

        .app-header h1 {
            font-family: Georgia, 'Palatino Linotype', Palatino, 'Book Antiqua', serif;
            font-size: clamp(1.6rem, 5vw, 2.1rem);
            color: var(--teal-deep);
            margin: 0 0 8px;
            letter-spacing: -0.01em;
        }

        .app-header .tagline {
            color: var(--muted);
            font-size: .9rem;
            font-weight: 300;
            max-width: 480px;
            margin: 0 auto;
        }

        /* â”€â”€ Mindfulness prompt â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .breathe-card {
            background: linear-gradient(135deg, var(--teal) 0%, var(--teal-deep) 100%);
            color: white;
            border-radius: var(--radius);
            padding: 18px 22px;
            margin-bottom: 28px;
            display: flex;
            gap: 14px;
            align-items: flex-start;
        }
        .breathe-card .icon { font-size: 1.5rem; flex-shrink: 0; margin-top: 2px; }
        .breathe-card p { margin: 0; font-size: .9rem; opacity: .93; }
        .breathe-card strong { font-weight: 600; display: block; margin-bottom: 4px; }

        /* â”€â”€ Form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .form-card {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 16px;
        }

        /* Collapsible fieldset header */
        .section-btn {
            width: 100%;
            background: var(--teal);
            color: white;
            border: none;
            padding: 13px 18px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            font-size: .95rem;
            font-weight: 600;
            text-align: left;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background var(--transition);
        }
        .section-btn:hover { background: var(--teal-deep); }
        .section-btn:focus-visible {
            outline: 3px solid var(--teal-light);
            outline-offset: -3px;
        }
        .section-btn .chevron {
            transition: transform var(--transition);
            font-size: .8rem;
        }
        .section-btn[aria-expanded="false"] .chevron { transform: rotate(-90deg); }

        .section-body {
            padding: 16px 18px;
        }
        .section-body[hidden] { display: none; }

        /* Checkboxes */
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .check-label {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--white);
            border: 1.5px solid var(--border);
            border-radius: 8px;
            padding: 10px 14px;
            cursor: pointer;
            transition: all var(--transition);
            font-size: .9rem;
            user-select: none;
        }
        .check-label:hover {
            border-color: var(--teal);
            background: var(--teal-light);
        }
        .check-label:has(input:checked) {
            border-color: var(--teal);
            background: var(--teal-light);
            font-weight: 500;
        }
        .check-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
            accent-color: var(--teal);
            cursor: pointer;
        }
        .check-label input[type="checkbox"]:focus-visible {
            outline: 3px solid var(--teal);
            outline-offset: 2px;
        }

        /* â”€â”€ Counter badge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .counter-bar {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 14px 18px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }
        .counter-bar .label {
            font-size: .85rem;
            color: var(--muted);
        }
        .counter-badge {
            background: var(--teal);
            color: white;
            font-weight: 600;
            font-size: .8rem;
            border-radius: 20px;
            padding: 3px 12px;
            min-width: 28px;
            text-align: center;
            transition: all var(--transition);
        }
        .counter-badge.has-items { background: var(--sage); }

        /* â”€â”€ Intensity â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .intensity-section {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 18px;
            margin-bottom: 16px;
        }
        .intensity-section label {
            display: block;
            font-weight: 600;
            font-size: .9rem;
            margin-bottom: 12px;
            color: var(--teal-deep);
        }
        .intensity-section .sub {
            font-weight: 400;
            font-size: .8rem;
            color: var(--muted);
            display: block;
        }
        .intensity-row {
            display: flex;
            align-items: center;
            gap: 14px;
        }
        input[type="range"] {
            flex: 1;
            accent-color: var(--teal);
            height: 6px;
            cursor: pointer;
        }
        .intensity-val {
            font-family: Georgia, 'Palatino Linotype', Palatino, 'Book Antiqua', serif;
            font-size: 1.4rem;
            color: var(--teal-deep);
            min-width: 28px;
            text-align: right;
        }
        .intensity-labels {
            display: flex;
            justify-content: space-between;
            font-size: .72rem;
            color: var(--muted);
            margin-top: 6px;
        }

        /* â”€â”€ Validation message â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .validation-msg {
            display: none;
            background: #fdf0f0;
            border: 1.5px solid var(--danger);
            border-radius: 8px;
            color: var(--danger);
            padding: 10px 14px;
            font-size: .85rem;
            margin-bottom: 12px;
            align-items: center;
            gap: 8px;
        }
        .validation-msg.visible { display: flex; }

        /* â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .btn-primary {
            display: block;
            width: 100%;
            background: var(--teal-deep);
            color: white;
            border: none;
            padding: 16px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            font-size: 1rem;
            font-weight: 600;
            border-radius: var(--radius);
            cursor: pointer;
            transition: background var(--transition), transform var(--transition);
            letter-spacing: .01em;
        }
        .btn-primary:hover { background: #1e373d; }
        .btn-primary:active { transform: scale(0.99); }
        .btn-primary:focus-visible { outline: 3px solid var(--teal); outline-offset: 3px; }

        .btn-secondary {
            display: none;
            width: 100%;
            background: transparent;
            color: var(--muted);
            border: 1.5px solid var(--border);
            padding: 12px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            font-size: .9rem;
            border-radius: var(--radius);
            cursor: pointer;
            margin-top: 10px;
            transition: all var(--transition);
        }
        .btn-secondary:hover { border-color: var(--teal); color: var(--teal-deep); }
        .btn-secondary.visible { display: block; }

        /* â”€â”€ Results â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #resultat {
            display: none;
            margin-top: 24px;
            animation: slideUp .4s ease;
        }
        #resultat.visible { display: block; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(14px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        .result-header {
            font-family: Georgia, 'Palatino Linotype', Palatino, 'Book Antiqua', serif;
            font-size: 1.1rem;
            color: var(--teal-deep);
            margin: 0 0 16px;
        }
        .result-header em {
            font-style: normal;
            font-weight: 400;
            color: var(--muted);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            font-size: .82rem;
            display: block;
            margin-top: 2px;
        }

        /* Emotion score bars */
        .score-grid {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 18px;
            margin-bottom: 20px;
        }
        .score-grid h3 {
            margin: 0 0 16px;
            font-size: .85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: .07em;
            color: var(--muted);
        }
        .score-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-size: .88rem;
        }
        .score-row:last-child { margin-bottom: 0; }
        .score-label {
            width: 90px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .score-bar-track {
            flex: 1;
            background: #eef1f2;
            border-radius: 20px;
            height: 10px;
            overflow: hidden;
        }
        .score-bar-fill {
            height: 100%;
            border-radius: 20px;
            transition: width .6s cubic-bezier(.22,1,.36,1);
        }
        .score-num {
            width: 30px;
            text-align: right;
            color: var(--muted);
            font-size: .78rem;
        }

        /* Emotion subtype badge */
        .subtype-badge {
            display: inline-block;
            font-size: .75rem;
            font-weight: 500;
            background: #f0f4f5;
            color: var(--teal-deep);
            border-radius: 20px;
            padding: 2px 10px;
            margin-left: 6px;
            vertical-align: middle;
        }

        /* Emotion result cards */
        .result-card {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 14px;
        }
        .result-card.primary-card { box-shadow: 0 4px 24px rgba(0,0,0,.10); }

        .result-card-header {
            padding: 16px 18px 14px;
            border-bottom: 1px solid #eef1f2;
        }
        .result-card-title {
            font-family: Georgia, 'Palatino Linotype', Palatino, 'Book Antiqua', serif;
            font-size: 1.3rem;
            color: var(--teal-deep);
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            margin: 0 0 6px;
        }
        .primary-badge {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            font-size: .7rem;
            font-weight: 600;
            background: var(--teal);
            color: white;
            border-radius: 20px;
            padding: 2px 8px;
            letter-spacing: .04em;
        }
        .result-card-desc {
            font-size: .88rem;
            color: var(--muted);
            margin: 0;
        }
        .result-card-body { padding: 16px 18px; }

        /* DBT skills accordion */
        .skill-title {
            font-size: .82rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: .07em;
            color: var(--teal-deep);
            margin: 0 0 10px;
        }

        .skill-item {
            border: 1.5px solid var(--border);
            border-radius: 8px;
            margin-bottom: 8px;
            overflow: hidden;
        }
        .skill-item.recommended-skill {
            border-color: var(--teal);
            background: var(--teal-light);
        }
        .skill-item-btn {
            width: 100%;
            background: none;
            border: none;
            padding: 10px 14px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            font-size: .85rem;
            font-weight: 500;
            text-align: left;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text);
            transition: background var(--transition);
        }
        .skill-item-btn:hover { background: var(--teal-light); }
        .skill-item-btn:focus-visible { outline: 2px solid var(--teal); outline-offset: -2px; }
        .skill-item-btn .skill-tag {
            font-size: .72rem;
            background: var(--teal-light);
            color: var(--teal-deep);
            border-radius: 20px;
            padding: 2px 8px;
            flex-shrink: 0;
            margin-left: 8px;
        }
        .skill-item-btn .rec-label {
            font-size: .68rem;
            background: var(--teal);
            color: white;
            border-radius: 20px;
            padding: 2px 8px;
            flex-shrink: 0;
            margin-left: 4px;
        }
        .skill-item-content {
            background: #fafcfc;
            border-top: 1px solid var(--border);
            padding: 12px 14px;
            font-size: .85rem;
            line-height: 1.7;
        }
        .skill-item-content[hidden] { display: none; }
        .skill-item-content ol, .skill-item-content ul {
            margin: 6px 0 0;
            padding-left: 18px;
        }
        .skill-item-content li { margin-bottom: 4px; }

        /* â”€â”€ Choose-one CTA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .cta-card {
            background: linear-gradient(135deg, var(--sage) 0%, #5a8a68 100%);
            color: white;
            border-radius: var(--radius);
            padding: 20px 22px;
            margin-bottom: 14px;
            text-align: center;
        }
        .cta-card h3 {
            font-family: Georgia, 'Palatino Linotype', Palatino, 'Book Antiqua', serif;
            font-size: 1.1rem;
            margin: 0 0 6px;
            font-weight: 400;
        }
        .cta-card p {
            margin: 0 0 14px;
            font-size: .88rem;
            opacity: .9;
        }
        .cta-card .cta-skill-name {
            display: inline-block;
            background: rgba(255,255,255,.2);
            border: 1.5px solid rgba(255,255,255,.4);
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
            font-size: .95rem;
            cursor: pointer;
            transition: all var(--transition);
        }
        .cta-card .cta-skill-name:hover {
            background: rgba(255,255,255,.3);
        }

        /* Secondary cards */
        .secondary-emotions {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 18px;
            margin-bottom: 14px;
        }
        .secondary-emotions h3 {
            font-size: .85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: .07em;
            color: var(--muted);
            margin: 0 0 14px;
        }
        .secondary-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: var(--teal-light);
            border-radius: 20px;
            padding: 5px 12px;
            font-size: .85rem;
            font-weight: 500;
            color: var(--teal-deep);
            margin: 0 6px 6px 0;
        }

        /* Print / timestamp */
        .result-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 24px;
            gap: 10px;
            flex-wrap: wrap;
        }
        .timestamp {
            font-size: .78rem;
            color: var(--muted);
        }
        .btn-print {
            background: none;
            border: 1.5px solid var(--border);
            border-radius: 8px;
            padding: 7px 14px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            font-size: .8rem;
            cursor: pointer;
            color: var(--muted);
            transition: all var(--transition);
        }
        .btn-print:hover { border-color: var(--teal); color: var(--teal-deep); }

        /* â”€â”€ Print styles â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @media print {
            body { background: white; padding: 0; }
            .breathe-card, .btn-primary, .btn-secondary, .btn-print,
            .section-btn, .counter-bar, .intensity-section,
            .form-card, .validation-msg, .cta-card { display: none !important; }
            .result-card { box-shadow: none; border: 1px solid #ccc; }
        }

        /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @media (min-width: 500px) {
            .checkbox-group { display: grid; grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>

<!-- â”€â”€ Disclaimer overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="disclaimer-overlay" role="dialog" aria-modal="true" aria-labelledby="disc-title" aria-describedby="disc-desc">
    <div class="disclaimer-card">
        <div class="disclaimer-top">
            <span class="disclaimer-icon" aria-hidden="true">ğŸ§­</span>
            <h2 id="disc-title">FÃ¸r du starter</h2>
            <p class="subtitle">Les dette kort â€” det tar under ett minutt</p>
        </div>
        <div class="disclaimer-body">

            <div class="disclaimer-alert" role="alert">
                <span class="alert-icon" aria-hidden="true">ğŸš¨</span>
                <p>
                    <strong>Ved akutt fare for deg selv eller andre</strong>
                    Ring <strong>113</strong> (ambulanse) eller oppsÃ¸k legevakt umiddelbart. Dette verktÃ¸yet er ikke egnet i akutte kriser.
                </p>
            </div>

            <ul class="disclaimer-points" id="disc-desc">
                <li>
                    <span class="dp-icon" aria-hidden="true">ğŸ”</span>
                    <span><strong>Dette er et selvrefleksjonsverktÃ¸y.</strong> Det hjelper deg Ã¥ utforske og sette ord pÃ¥ det kroppen din signaliserer â€” basert pÃ¥ prinsipper fra Dialektisk Atferdsterapi (DBT).</span>
                </li>
                <li>
                    <span class="dp-icon" aria-hidden="true">ğŸ©º</span>
                    <span><strong>Det erstatter ikke terapi eller behandling.</strong> VerktÃ¸yet er ikke ment som diagnostikk og kan ikke ta hensyn til din individuelle situasjon slik en terapeut ville gjort.</span>
                </li>
                <li>
                    <span class="dp-icon" aria-hidden="true">ğŸ¤</span>
                    <span><strong>Bruk det som et supplement.</strong> Gjerne ta med innsikter fra verktÃ¸yet til neste samtale med din behandler eller et betrodd menneske.</span>
                </li>
                <li>
                    <span class="dp-icon" aria-hidden="true">ğŸ”’</span>
                    <span><strong>Ingenting lagres.</strong> Svarene dine forsvinner nÃ¥r du lukker siden. VerktÃ¸yet sender ingen data noe sted.</span>
                </li>
            </ul>

            <button type="button" class="disclaimer-confirm" id="disclaimerConfirmBtn">
                Jeg forstÃ¥r â€” ta meg til verktÃ¸yet
            </button>
            <p class="disclaimer-footer">
                Trenger du noen Ã¥ snakke med? Ring Mental Helselinje: <strong>116 123</strong> (gratis, dÃ¸gnet rundt)
            </p>
        </div>
    </div>
</div>

<div class="container" role="main">

    <!-- Header -->
    <header class="app-header">
        <h1>Hva forteller kroppen din?</h1>
        <p class="tagline">Et DBT-basert verktÃ¸y for Ã¥ koble kroppslige fornemmelser til fÃ¸lelser</p>
    </header>

    <!-- Mindfulness prompt -->
    <div class="breathe-card" role="note" aria-label="Innledende instruksjon">
        <div class="icon" aria-hidden="true">ğŸ«</div>
        <p>
            <strong>FÃ¸r du begynner â€” ta ett Ã¸yeblikk</strong>
            Ta et rolig innpust og pust langsomt ut. Kjenn etter i kroppen din uten Ã¥ dÃ¸mme det du merker. Kryss sÃ¥ av for alt du legger merke til akkurat nÃ¥.
        </p>
    </div>

    <!-- Checker form -->
    <form id="bodyScanForm" novalidate aria-label="Kroppsscan-skjema">

        <!-- Counter -->
        <div class="counter-bar" aria-live="polite" aria-atomic="true">
            <span class="label">Antall fornemmelser valgt</span>
            <span class="counter-badge" id="counterBadge">0</span>
        </div>

        <!-- Hode, ansikt & hals -->
        <div class="form-card">
            <button type="button" class="section-btn" aria-expanded="true" aria-controls="sec-hode" id="btn-hode">
                <span>ğŸ˜® Hode, Ansikt &amp; Hals</span>
                <span class="chevron" aria-hidden="true">â–¼</span>
            </button>
            <div id="sec-hode" role="group" aria-labelledby="btn-hode" class="section-body">
                <div class="checkbox-group">
                    <label class="check-label">
                        <input type="checkbox" value="sinne,skam" data-text="Varme i ansiktet">
                        <span>ğŸ”´ Varme / RÃ¸dming i ansiktet</span>
                    </label>
                    <label class="check-label">
                        <input type="checkbox" value="sinne,frykt" data-text="Stram kjeve">
                        <span>ğŸ˜¬ Stram kjeve / Biter tennene</span>
                    </label>
                    <label class="check-label">
                        <input type="checkbox" value="tristhet,glede" data-text="TÃ¥rer">
                        <span>ğŸ’§ TÃ¥rer / Press bak Ã¸ynene</span>
                    </label>
                    <label class="check-label">
                        <input type="checkbox" value="skam,tristhet" data-text="UnngÃ¥r blikk">
                        <span>ğŸ‘‡ Vil se ned / UnngÃ¥ blikkontakt</span>
                    </label>
                    <label class="check-label">
                        <input type="checkbox" value="tristhet,frykt" data-text="Klump i halsen">
                        <span>ğŸ«¶ Klump i halsen / Vanskelig Ã¥ svelge</span>
                    </label>
                    <label class="check-label">
                        <input type="checkbox" value="avsky" data-text="Avsky i ansiktet">
                        <span>ğŸ˜’ Rynker pÃ¥ nesen / Snurper munnen</span>
                    </label>
                    <label class="check-label">
                        <input type="checkbox" value="frykt,skam" data-text="Spent opp">
                        <span>ğŸ˜³ Spente muskler / Frossen i ansiktet</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Bryst & pust -->
        <div class="form-card">
            <button type="button" class="section-btn" aria-expanded="true" aria-controls="sec-bryst" id="btn-bryst">
                <span>ğŸ«€ Bryst &amp; Pust</span>
                <span class="chevron" aria-hidden="true">â–¼</span>
            </button>
            <div id="sec-bryst" role="group" aria-labelledby="btn-bryst" class="section-body">
                <div class="checkbox-group">
                    <label class="check-label">
                        <input type="checkbox" value="frykt,sinne" data-text="Hjertebank">
                        <span>ğŸ’“ Hjertebank / Rask puls</span>
                    </label>
                    <label class="check-label">
                        <input type="checkbox" value="frykt,sinne" data-text="Overflatisk pust">
                        <span>ğŸ’¨ Rask / Overflatisk pust</span>
                    </label>
                    <label class="check-label">
                        <input type="checkbox" value="tristhet,frykt" data-text="Tyngde i brystet">
                        <span>ğŸª¨ Tyngde eller press i brystet</span>
                    </label>
                    <label class="check-label">
                        <input type="checkbox" value="glede" data-text="Ã…pent bryst">
                        <span>ğŸŒ¬ï¸ Letthet / Puster fritt og rolig</span>
                    </label>
                    <label class="check-label">
                        <input type="checkbox" value="frykt" data-text="Holder pusten">
                        <span>ğŸ˜®â€ğŸ’¨ Holder pusten / Glemmer Ã¥ puste</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Mage & fordÃ¸yelse -->
        <div class="form-card">
            <button type="button" class="section-btn" aria-expanded="true" aria-controls="sec-mage" id="btn-mage">
                <span>ğŸŒ€ Mage &amp; Indre</span>
                <span class="chevron" aria-hidden="true">â–¼</span>
            </button>
            <div id="sec-mage" role="group" aria-labelledby="btn-mage" class="section-body">
                <div class="checkbox-group">
                    <label class="check-label">
                        <input type="checkbox" value="frykt,glede" data-text="Sommerfugler">
                        <span>ğŸ¦‹ "Sommerfugler" i magen</span>
                    </label>
                    <label class="check-label">
                        <input type="checkbox" value="frykt,avsky" data-text="Knute i magen">
                        <span>ğŸª¢ Knute i magen / Kvalme</span>
                    </label>
                    <label class="check-label">
                        <input type="checkbox" value="tristhet" data-text="Tomhet i magen">
                        <span>ğŸ•³ï¸ En fÃ¸lelse av tomhet eller "hull"</span>
                    </label>
                    <label class="check-label">
                        <input type="checkbox" value="sinne,frykt" data-text="Mageuro">
                        <span>âš¡ Mageuro / Magekramper</span>
                    </label>
                    <label class="check-label">
                        <input type="checkbox" value="glede" data-text="Ro i magen">
                        <span>â˜€ï¸ Varme og ro i magen</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Armer, ben & generelt -->
        <div class="form-card">
            <button type="button" class="section-btn" aria-expanded="true" aria-controls="sec-kropp" id="btn-kropp">
                <span>ğŸ¦¾ Armer, Ben &amp; Generelt</span>
                <span class="chevron" aria-hidden="true">â–¼</span>
            </button>
            <div id="sec-kropp" role="group" aria-labelledby="btn-kropp" class="section-body">
                <div class="checkbox-group">
                    <label class="check-label">
                        <input type="checkbox" value="sinne" data-text="Knyttede never">
                        <span>âœŠ Knyttede never / Spent i hender</span>
                    </label>
                    <label class="check-label">
                        <input type="checkbox" value="frykt" data-text="Svette hender">
                        <span>ğŸ–ï¸ Klamme / Svette hender</span>
                    </label>
                    <label class="check-label">
                        <input type="checkbox" value="sinne,frykt" data-text="Skjelving">
                        <span>ğŸ«¨ Skjelving / Risting i kroppen</span>
                    </label>
                    <label class="check-label">
                        <input type="checkbox" value="tristhet,skam" data-text="Tung kropp">
                        <span>âš“ Tung kropp / Lite energi</span>
                    </label>
                    <label class="check-label">
                        <input type="checkbox" value="sinne" data-text="RastlÃ¸shet">
                        <span>ğŸƒ RastlÃ¸shet / Impuls til Ã¥ handle</span>
                    </label>
                    <label class="check-label">
                        <input type="checkbox" value="skam,frykt" data-text="Vil gjemme seg">
                        <span>ğŸ¢ Vil gjÃ¸re seg liten / Gjemme seg</span>
                    </label>
                    <label class="check-label">
                        <input type="checkbox" value="glede" data-text="Avslappet kropp">
                        <span>ğŸ˜Œ Musklene varme og avslappede</span>
                    </label>
                    <label class="check-label">
                        <input type="checkbox" value="frykt,tristhet" data-text="Nummenhet">
                        <span>ğŸ§Š Nummenhet / FÃ¸lelsesmessig flathet</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Intensity -->
        <div class="intensity-section">
            <label for="intensitySlider">
                Hvor sterk er opplevelsen akkurat nÃ¥?
                <span class="sub">0 = knapt merkbar, 10 = overveldende</span>
            </label>
            <div class="intensity-row">
                <input type="range" id="intensitySlider" min="0" max="10" value="5" step="1"
                       aria-valuenow="5" aria-valuemin="0" aria-valuemax="10"
                       aria-label="Intensitet fra 0 til 10">
                <span class="intensity-val" id="intensityVal" aria-live="polite">5</span>
            </div>
            <div class="intensity-labels" aria-hidden="true">
                <span>Svak</span>
                <span>Moderat</span>
                <span>Sterk</span>
            </div>
        </div>

        <!-- Validation -->
        <div class="validation-msg" id="validationMsg" role="alert" aria-live="assertive" tabindex="-1">
            <span>âš ï¸</span>
            <span>Vennligst kryss av for minst Ã©n ting du kjenner i kroppen.</span>
        </div>

        <button type="button" class="btn-primary" id="analyzeBtn">
            Hva kan dette bety? â†’
        </button>

    </form>

    <!-- Results -->
    <div id="resultat" aria-live="polite" aria-label="Resultat">
        <!-- Inserted by JS -->
    </div>

    <button type="button" class="btn-secondary" id="resetBtn" aria-label="Nullstill skjemaet">
        â†© Nullstill og start pÃ¥ nytt
    </button>

</div><!-- /container -->

<script>
'use strict';

/* â”€â”€ Disclaimer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
(function () {
    const overlay = document.getElementById('disclaimer-overlay');
    const confirmBtn = document.getElementById('disclaimerConfirmBtn');
    document.body.classList.add('overlay-open');

    confirmBtn.addEventListener('click', () => {
        overlay.classList.add('hidden');
        document.body.classList.remove('overlay-open');
        document.querySelector('.container').setAttribute('tabindex', '-1');
        document.querySelector('.container').focus();
    });

    overlay.addEventListener('keydown', e => {
        if (e.key !== 'Tab') return;
        const focusable = overlay.querySelectorAll('button, [href], input, [tabindex]:not([tabindex="-1"])');
        const first = focusable[0];
        const last  = focusable[focusable.length - 1];
        if (e.shiftKey) {
            if (document.activeElement === first) { e.preventDefault(); last.focus(); }
        } else {
            if (document.activeElement === last) { e.preventDefault(); first.focus(); }
        }
    });

    confirmBtn.focus();
})();

/* â”€â”€ Emotion database â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const emotionData = {
    frykt: {
        title: "Frykt / Angst",
        icon: "ğŸ˜¨",
        color: "var(--col-frykt)",
        desc: "Kroppen mobiliserer for Ã¥ beskytte deg mot en opplevd trussel â€” kjemp, flykt eller frys. Dette er et evolusjonsbiologisk alarmsystem.",
        /* NEW: subtypes based on intensity */
        subtypes: {
            low:  { label: "Uro / Bekymring", desc: "En mild uro â€” kroppen sier Â«vÃ¦r oppmerksomÂ», men det er ikke akutt fare." },
            mid:  { label: "Frykt / Anspenthet", desc: "Kroppen er tydelig aktivert. Du merker at noe oppleves truende." },
            high: { label: "Akutt angst / Panikk", desc: "Kroppen er i full alarmberedskap. Nervesystemet kjÃ¸rer kjemp-eller-flykt pÃ¥ hÃ¸ygir." }
        },
        skills: [
            {
                name: "Sjekk fakta",
                tag: "Emosjonsregulering",
                priority: "reflective", /* shown first at low intensity */
                content: `<p>SpÃ¸r deg selv: <em>Â«Er det en reell trussel her og nÃ¥, eller tolker hjernen min situasjonen som farligere enn den er?Â»</em></p>
                <p>Skriv ned hva du tror vil skje, og vurder sannsynligheten objektivt.</p>`
            },
            {
                name: "Motsatt handling (Opposite Action)",
                tag: "Emosjonsregulering",
                priority: "reflective",
                content: `<p>Hvis frykten ikke er berettiget i situasjonen: GjÃ¸r det stikk motsatte av hva frykten ber deg om.</p>
                <ol><li>NÃ¦rm deg det du unngÃ¥r â€” i smÃ¥ trinn</li><li>Gjenta til frykten reduseres</li></ol>`
            },
            {
                name: "4-7-8 Pust",
                tag: "Stresstoleranse / TIPP",
                priority: "crisis",  /* shown first at high intensity */
                content: `<p>Pust inn i 4 sekunder â†’ hold i 7 â†’ pust rolig ut i 8. Gjenta 3â€“4 ganger. Aktiverer det parasympatiske nervesystemet.</p>`
            },
            {
                name: "TIPP â€“ senk fysiologisk aktivering",
                tag: "Stresstoleranse",
                priority: "crisis",
                content: `<ul>
                <li><strong>T</strong>emperatur â€“ Kaldt vann i ansiktet senker pulsen raskt</li>
                <li><strong>I</strong>ntensiv trening â€“ Rask bevegelse i 20 min</li>
                <li><strong>P</strong>ust med pacing â€“ Langsom utpust</li>
                <li><strong>P</strong>rogressiv muskelavslapning</li></ul>`
            }
        ]
    },
    sinne: {
        title: "Sinne / Irritasjon",
        icon: "ğŸ˜ ",
        color: "var(--col-sinne)",
        desc: "Kroppen er klar til kamp. Du har sannsynligvis opplevd urettferdighet, brudd pÃ¥ grenser, eller blokkering av et mÃ¥l. Sinne er ofte et sekundÃ¦rt signal.",
        subtypes: {
            low:  { label: "Irritasjon / Frustrasjon", desc: "Noe gnager, men det er hÃ¥ndterbart. Kroppen gir et mildt signal." },
            mid:  { label: "Sinne", desc: "Du kjenner tydelig at noe er urettferdig eller blokkerer deg. Kroppen er aktivert." },
            high: { label: "Raseri / Intens frustrasjon", desc: "Kroppen er i full kampmodus. Impulsen til Ã¥ handle er sterk og umiddelbar." }
        },
        skills: [
            {
                name: "STOPP-ferdigheten",
                tag: "Mindfulness",
                priority: "always_top",
                content: `<ol>
                <li><strong>S</strong>topp â€” frys, ikke gjÃ¸r noe impulsivt</li>
                <li><strong>T</strong>a et skritt tilbake â€” trekk deg fysisk eller mentalt ut av situasjonen</li>
                <li><strong>O</strong>bserver â€” hva skjer i kroppen, tankene og rundt deg?</li>
                <li><strong>P</strong>ust rolig â€” noen dype pust fÃ¸r du handler</li>
                <li><strong>P</strong>rosed bevisst â€” velg en klok handling i stedet for en impulsiv</li></ol>`
            },
            {
                name: "Sjekk sekundÃ¦remosjon",
                tag: "Emosjonsregulering",
                priority: "reflective",
                content: `<p>Sinne skjuler ofte en underliggende primÃ¦remosjon: frykt, sorg, skam eller skuffelse. SpÃ¸r: <em>Â«Hva er den underliggende smerten her?Â»</em></p>`
            },
            {
                name: "ProblemlÃ¸sning",
                tag: "Emosjonsregulering",
                priority: "reflective",
                content: `<p>Hvis sinnet er berettiget og situasjonen kan endres:</p>
                <ol><li>Definer problemet konkret</li><li>Brainstorm lÃ¸sninger</li><li>Velg Ã©n og test den</li></ol>`
            },
            {
                name: "Fysiologisk kjÃ¸ling",
                tag: "Stresstoleranse / TIPP",
                priority: "crisis",
                content: `<p>Kaldt vann i ansiktet eller ned langs underarmene aktiverer dykkerrefleksen og senker pulsen raskt. Alternativt: intensiv bevegelse for Ã¥ Â«brenne avÂ» den aktiverte energien.</p>`
            }
        ]
    },
    tristhet: {
        title: "Tristhet / Sorg",
        icon: "ğŸ˜¢",
        color: "var(--col-tristhet)",
        desc: "Kroppen signaliserer tap, savn eller behov for trÃ¸st og hvile. Energien trekkes innover. Tristhet er et naturlig og sunt signal â€” ikke noe som skal bort umiddelbart.",
        subtypes: {
            low:  { label: "Melankoli / Vemod", desc: "En mild tristhet â€” du kjenner at noe mangler, men det er ikke overveldende." },
            mid:  { label: "Tristhet / Sorg", desc: "Tapet eller savnet er tydelig. Kroppen Ã¸nsker trÃ¸st og hvile." },
            high: { label: "Dyp sorg / Fortvilelse", desc: "Smerten er intens. Alt fÃ¸les tungt, og det er vanskelig Ã¥ se fremover." }
        },
        skills: [
            {
                name: "Radikal aksept",
                tag: "Stresstoleranse",
                priority: "reflective",
                content: `<p>Aksepter det smertefulle som faktisk er, uten Ã¥ kjempe mot det. Aksept betyr ikke at du liker det â€” det betyr at du slutter Ã¥ bruke energi pÃ¥ Ã¥ nekte virkeligheten.</p>
                <p><em>Â«Dette er slik det er. Og det er vondt.Â»</em></p>`
            },
            {
                name: "SelvmedfÃ¸lelse",
                tag: "Emosjonsregulering",
                priority: "crisis",
                content: `<p>Snakk til deg selv slik du ville snakket til en god venn som hadde det vondt. Legg en hÃ¥nd pÃ¥ hjertet og si:</p>
                <p><em>Â«Det er lov Ã¥ ha det vondt. Jeg er ikke alene om dette.Â»</em></p>`
            },
            {
                name: "Atferdsaktivering â€“ ett lite steg",
                tag: "Emosjonsregulering",
                priority: "reflective",
                content: `<p>NÃ¥r tristheten gjÃ¸r det vanskelig Ã¥ handle: Velg Ã©n enkel, meningsfull aktivitet (dusje, gÃ¥ en kort tur, lage te). Mestring bygges i smÃ¥ skritt.</p>`
            },
            {
                name: "PLEASE â€“ reduser sÃ¥rbarhet",
                tag: "Emosjonsregulering",
                priority: "reflective",
                content: `<ul>
                <li><strong>P</strong>leie sykdommer og fysisk helse</li>
                <li><strong>L</strong>evende, balansert kosthold</li>
                <li><strong>E</strong>liminÃ©r rusmidler</li>
                <li><strong>A</strong>ktivitet â€“ beveg kroppen regelmessig</li>
                <li><strong>S</strong>Ã¸vn â€“ nok og regelmessig</li>
                <li><strong>E</strong>ngasjer deg i mestringsaktiviteter</li></ul>`
            }
        ]
    },
    skam: {
        title: "Skam",
        icon: "ğŸ˜³",
        color: "var(--col-skam)",
        desc: "Kroppen vil gjemme seg eller forsvinne. Skam handler om hvem du er ('jeg er feil'), mens skyld handler om hva du har gjort. Skam er svÃ¦rt ubehagelig, men forteller deg ikke alltid sannheten.",
        subtypes: {
            low:  { label: "Usikkerhet / Flauhet", desc: "En lett fÃ¸lelse av Ã¥ vÃ¦re utilstrekkelig eller forlegen." },
            mid:  { label: "Skam", desc: "Du opplever deg selv som Â«feilÂ» pÃ¥ et dypere plan. Impulsen til Ã¥ gjemme seg er tydelig." },
            high: { label: "Dyp skam / Selvforakt", desc: "En intens fÃ¸lelse av Ã¥ vÃ¦re fundamentalt mangelfull. Smerten er gjennomgripende." }
        },
        skills: [
            {
                name: "Sjekk fakta om skammen",
                tag: "Emosjonsregulering",
                priority: "reflective",
                content: `<p>Skam er berettiget kun hvis du faktisk har brutt egne verdier. SpÃ¸r:</p>
                <ul><li>Â«Har jeg faktisk gjort noe som bryter med verdiene mine?Â»</li>
                <li>Â«Eller <em>fÃ¸les</em> det bare slik?Â»</li></ul>`
            },
            {
                name: "Motsatt handling for skam",
                tag: "Emosjonsregulering",
                priority: "crisis",
                content: `<p>Skam vil at du skal gjemme deg. Motsatt handling er Ã¥ eksponere deg:</p>
                <ol><li>Hev hodet â€” rett ryggen</li><li>Hold Ã¸yekontakt</li><li>Del det du skammer deg over med en trygg person</li></ol>
                <p>Skam trives i mÃ¸rket og visner i lyset.</p>`
            },
            {
                name: "Ikke-dÃ¸mmende beskrivelse",
                tag: "Mindfulness",
                priority: "reflective",
                content: `<p>Beskriv situasjonen faktabasert, uten evalueringer eller merkelapper. Bruk Â«ogÂ» i stedet for Â«menÂ». UnngÃ¥ ord som Â«dÃ¥rligÂ», Â«svakÂ», Â«feilÂ».</p>`
            }
        ]
    },
    avsky: {
        title: "Avsky",
        icon: "ğŸ¤¢",
        color: "var(--col-avsky)",
        desc: "Kroppen vil avvise noe som oppleves giftig, fremmed eller truende. Avsky kan rettes mot noe utenfor deg selv â€” eller mot deg selv.",
        subtypes: {
            low:  { label: "Ubehag / Motvilje", desc: "Noe fÃ¸les frastÃ¸tende, men det er mildt og hÃ¥ndterbart." },
            mid:  { label: "Avsky", desc: "Du kjenner en tydelig fysisk reaksjon â€” kroppen vil avvise noe." },
            high: { label: "Intens avsky / Kvalme", desc: "Kroppen reagerer kraftig. Det er vanskelig Ã¥ vÃ¦re i nÃ¦rheten av det som trigger reaksjonen." }
        },
        skills: [
            {
                name: "Identifiser hva avskyen retter seg mot",
                tag: "Emosjonsregulering",
                priority: "reflective",
                content: `<p>Er avskyen rettet mot:</p>
                <ul><li>Noe <em>utenfor</em> deg (mat, person, situasjon)?</li>
                <li>Noe <em>ved deg selv</em>?</li></ul>
                <p>Selvrettet avsky kan vÃ¦re skam i en annen drakt â€” bruk da skam-verktÃ¸yene over.</p>`
            },
            {
                name: "Ikke-dÃ¸mmende oppmerksomhet",
                tag: "Mindfulness",
                priority: "reflective",
                content: `<p>Ã˜v pÃ¥ Ã¥ beskrive det du reagerer pÃ¥ uten Ã¥ bruke avskysord (Â«ekkelÂ», Â«grusomÂ»). Bruk nÃ¸ytrale observasjoner:</p>
                <p><em>Â«Det lukter sterktÂ»</em> i stedet for <em>Â«Det er kvalmendeÂ»</em>.</p>`
            }
        ]
    },
    glede: {
        title: "Glede / Ro",
        icon: "ğŸ˜Š",
        color: "var(--col-glede)",
        desc: "Kroppen er i balanse â€” trygg, Ã¥pen og tilstede. Dette er en tilstand som bygger motstandskraft og psykologisk kapasitet.",
        subtypes: {
            low:  { label: "Tilfredshet / Ro", desc: "En stille, god tilstand. Kroppen er avslappet og i balanse." },
            mid:  { label: "Glede", desc: "Du kjenner en tydelig positiv fÃ¸lelse â€” en varme og letthet i kroppen." },
            high: { label: "Dyp glede / Takknemlighet", desc: "En sterk opplevelse av mening, forbindelse eller takknemlighet." }
        },
        skills: [
            {
                name: "VÃ¦r fullt tilstede (Mindfulness)",
                tag: "Mindfulness",
                priority: "reflective",
                content: `<p>La deg vÃ¦re i den gode fÃ¸lelsen uten Ã¥ bekymre deg for nÃ¥r den tar slutt. Beskriv den gjerne for deg selv:</p>
                <p><em>Â«Akkurat nÃ¥ kjenner jeg... og det er godt.Â»</em></p>`
            },
            {
                name: "Bygg positive erfaringer",
                tag: "Emosjonsregulering",
                priority: "reflective",
                content: `<p>Planlegg Ã©n aktivitet per dag som er meningsfull eller hyggelig. Over tid reduserer dette sÃ¥rbarhet for negative emosjoner.</p>`
            }
        ]
    }
};

/* â”€â”€ DOM refs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const form        = document.getElementById('bodyScanForm');
const analyzeBtn  = document.getElementById('analyzeBtn');
const resetBtn    = document.getElementById('resetBtn');
const resultat    = document.getElementById('resultat');
const counterBadge = document.getElementById('counterBadge');
const validationMsg = document.getElementById('validationMsg');
const intensitySlider = document.getElementById('intensitySlider');
const intensityVal    = document.getElementById('intensityVal');

/* â”€â”€ Intensity slider â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
intensitySlider.addEventListener('input', () => {
    const v = intensitySlider.value;
    intensityVal.textContent = v;
    intensitySlider.setAttribute('aria-valuenow', v);
});

/* â”€â”€ Checkbox counter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
form.addEventListener('change', () => {
    const count = form.querySelectorAll('input[type="checkbox"]:checked').length;
    counterBadge.textContent = count;
    counterBadge.classList.toggle('has-items', count > 0);
    if (count > 0) validationMsg.classList.remove('visible');
});

/* â”€â”€ Collapsible sections â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.querySelectorAll('.section-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!expanded));
        const panel = document.getElementById(btn.getAttribute('aria-controls'));
        panel.hidden = expanded;
    });
});

/* â”€â”€ Helper: get intensity tier â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function getIntensityTier(intensity) {
    if (intensity <= 3) return 'low';
    if (intensity <= 7) return 'mid';
    return 'high';
}

/* â”€â”€ Helper: sort skills by intensity â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function sortSkillsByIntensity(skills, intensity) {
    const tier = getIntensityTier(intensity);
    const sorted = [...skills];
    sorted.sort((a, b) => {
        // always_top beats everything
        if (a.priority === 'always_top' && b.priority !== 'always_top') return -1;
        if (a.priority !== 'always_top' && b.priority === 'always_top') return 1;
        if (tier === 'high') {
            // Crisis skills next at high intensity
            if (a.priority === 'crisis' && b.priority === 'reflective') return -1;
            if (a.priority === 'reflective' && b.priority === 'crisis') return 1;
        } else {
            // Reflective skills next at low/mid intensity
            if (a.priority === 'reflective' && b.priority === 'crisis') return -1;
            if (a.priority === 'crisis' && b.priority === 'reflective') return 1;
        }
        return 0;
    });
    return sorted;
}

/* â”€â”€ Analyze â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
analyzeBtn.addEventListener('click', analyzeEmotion);
resetBtn.addEventListener('click', resetForm);

function analyzeEmotion() {
    const checkboxes = form.querySelectorAll('input[type="checkbox"]:checked');

    if (checkboxes.length === 0) {
        validationMsg.classList.add('visible');
        validationMsg.focus();
        return;
    }
    validationMsg.classList.remove('visible');

    const intensity = parseInt(intensitySlider.value, 10);
    const tier = getIntensityTier(intensity);

    // Score emotions by raw body-signal counts
    // Intensity is a separate dimension â€” it affects subtype + skill order, not the score itself
    const keys = Object.keys(emotionData);
    const scores = {};
    keys.forEach(k => { scores[k] = 0; });

    const sensations = [];
    checkboxes.forEach(box => {
        sensations.push(box.getAttribute('data-text'));
        box.value.split(',').forEach(emo => {
            if (scores[emo] !== undefined) scores[emo]++;
        });
    });

    const maxScore = Math.max(...Object.values(scores));
    if (maxScore === 0) {
        resultat.innerHTML = '<p>Kroppen sender blandede signaler. Pust rolig i 1 minutt og prÃ¸v igjen.</p>';
        resultat.classList.add('visible');
        return;
    }

    // Sort by score descending
    const ranked = keys
        .map(k => ({ key: k, score: scores[k] }))
        .sort((a, b) => b.score - a.score)
        .filter(x => x.score > 0);

    const topScore = ranked[0].score;
    const topEmotions = ranked.filter(x => x.score === topScore);
    const secondaryEmotions = ranked.filter(x => x.score < topScore && x.score > 0);

    const intensityLabel = intensity <= 3 ? 'lav' : intensity <= 7 ? 'moderat' : 'hÃ¸y';
    const timestamp = new Date().toLocaleString('nb-NO', { dateStyle: 'medium', timeStyle: 'short' });

    // --- Build score bars (raw body-signal counts) ---
    const allForBars = ranked.concat(
        keys.filter(k => scores[k] === 0).map(k => ({ key: k, score: 0 }))
    );

    let scoreBarsHtml = `<div class="score-grid">
        <h3 id="score-heading">Emosjonsprofil</h3>
        <p style="font-size:.78rem;color:var(--muted);margin:-8px 0 14px;">Basert pÃ¥ ${checkboxes.length} kroppslige fornemmelser</p>
        <div role="list" aria-labelledby="score-heading">`;

    allForBars.forEach(({ key, score }) => {
        const data = emotionData[key];
        const pct = maxScore > 0 ? Math.round((score / maxScore) * 100) : 0;
        scoreBarsHtml += `
            <div class="score-row" role="listitem">
                <span class="score-label">${data.icon} ${data.title.split(' / ')[0]}</span>
                <div class="score-bar-track" role="presentation">
                    <div class="score-bar-fill" style="width:${pct}%; background:${data.color};" 
                         aria-label="${data.title}: ${score} treff"></div>
                </div>
                <span class="score-num">${score}</span>
            </div>`;
    });
    scoreBarsHtml += '</div></div>';

    // --- Build primary result cards with subtypes and sorted skills ---
    let cardsHtml = '';
    let firstRecommendedSkill = null;
    let firstRecommendedEmotionKey = null;

    topEmotions.forEach((item, idx) => {
        const data = emotionData[item.key];
        const isPrimary = idx === 0;

        // â”€â”€ IMPROVEMENT 2: Emotion subtype â”€â”€
        const subtype = data.subtypes[tier];
        const subtypeBadge = `<span class="subtype-badge">${subtype.label}</span>`;

        // â”€â”€ IMPROVEMENT 3: Sort skills by intensity â”€â”€
        const sortedSkills = sortSkillsByIntensity(data.skills, intensity);

        // Track first recommended skill for CTA
        if (isPrimary && sortedSkills.length > 0) {
            firstRecommendedSkill = sortedSkills[0];
            firstRecommendedEmotionKey = item.key;
        }

        const skillsHtml = sortedSkills.map((s, si) => {
            const isFirst = si === 0 && isPrimary;
            const recClass = isFirst ? 'recommended-skill' : '';
            const recLabel = isFirst ? '<span class="rec-label">ANBEFALT NÃ…</span>' : '';
            return `
            <div class="skill-item ${recClass}">
                <button type="button" class="skill-item-btn"
                        aria-expanded="${isFirst ? 'true' : 'false'}"
                        aria-controls="skill-${item.key}-${si}"
                        id="skill-btn-${item.key}-${si}">
                    <span>${s.name} ${recLabel}</span>
                    <span class="skill-tag">${s.tag}</span>
                </button>
                <div id="skill-${item.key}-${si}" class="skill-item-content" ${isFirst ? '' : 'hidden'}>
                    ${s.content}
                </div>
            </div>`;
        }).join('');

        cardsHtml += `
            <div class="result-card ${isPrimary ? 'primary-card' : ''}" role="article"
                 aria-label="${data.title}">
                <div class="result-card-header">
                    <div class="result-card-title">
                        <span aria-hidden="true">${data.icon}</span>
                        ${data.title}
                        ${subtypeBadge}
                        ${isPrimary ? '<span class="primary-badge">STERKEST</span>' : ''}
                    </div>
                    <p class="result-card-desc">${subtype.desc}</p>
                </div>
                <div class="result-card-body">
                    <p class="skill-title">DBT-ferdigheter Ã¥ prÃ¸ve ${tier === 'high' ? 'Â· Kriseferdigheter prioritert' : 'Â· Refleksjonsferdigheter prioritert'}</p>
                    ${skillsHtml}
                </div>
            </div>`;
    });

    // --- Secondary emotions ---
    let secondaryHtml = '';
    if (secondaryEmotions.length > 0) {
        const tags = secondaryEmotions.map(e => {
            const d = emotionData[e.key];
            const st = d.subtypes[tier];
            return `<span class="secondary-tag">${d.icon} ${st.label}</span>`;
        }).join('');
        secondaryHtml = `
            <div class="secondary-emotions">
                <h3>Andre emosjoner som kan vÃ¦re til stede</h3>
                ${tags}
                <p style="font-size:.82rem; color:var(--muted); margin-top:10px;">
                    Emosjoner opptrer sjelden alene. Det er helt normalt Ã¥ kjenne flere pÃ¥ Ã©n gang.
                </p>
            </div>`;
    }

    // --- Intensity warning ---
    let intensityNote = '';
    if (intensity >= 8) {
        intensityNote = `<div class="breathe-card" style="margin-bottom:16px;" role="note">
            <div class="icon">âš ï¸</div>
            <p><strong>Du rapporterer ${intensityLabel} intensitet (${intensity}/10)</strong><br>
            Kriseferdigheter er lÃ¸ftet Ã¸verst. Vurder Ã¥ bruke TIPP-ferdigheten eller en kriseberedskapsplan hvis det er vanskelig Ã¥ fungere.</p>
        </div>`;
    }

    // â”€â”€ IMPROVEMENT 4: Choose-one CTA â”€â”€
    let ctaHtml = '';
    if (firstRecommendedSkill) {
        const targetId = `skill-btn-${firstRecommendedEmotionKey}-0`;
        ctaHtml = `
            <div class="cta-card">
                <h3>Velg Ã©n ting Ã¥ prÃ¸ve akkurat nÃ¥</h3>
                <p>Du trenger ikke gjÃ¸re alt â€” ett lite steg er nok.</p>
                <a class="cta-skill-name" href="#${targetId}" 
                   onclick="document.getElementById('${targetId}').scrollIntoView({behavior:'smooth',block:'center'}); return false;">
                    â†’ ${firstRecommendedSkill.name}
                </a>
            </div>`;
    }

    // --- Full result ---
    resultat.innerHTML = `
        <h2 class="result-header">
            Basert pÃ¥ det du kjenner akkurat nÃ¥
            <em>Fornemmelser: ${sensations.join(', ')} Â· Intensitet: ${intensity}/10 (${intensityLabel})</em>
        </h2>
        ${intensityNote}
        ${ctaHtml}
        ${scoreBarsHtml}
        ${cardsHtml}
        ${secondaryHtml}
        <div class="result-footer">
            <span class="timestamp">Registrert: ${timestamp}</span>
            <button type="button" class="btn-print" onclick="window.print()">ğŸ–¨ï¸ Skriv ut / Lagre</button>
        </div>
    `;

    resultat.classList.add('visible');
    resetBtn.classList.add('visible');

    // Wire skill accordion after injection
    resultat.querySelectorAll('.skill-item-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const expanded = btn.getAttribute('aria-expanded') === 'true';
            btn.setAttribute('aria-expanded', String(!expanded));
            const panel = document.getElementById(btn.getAttribute('aria-controls'));
            panel.hidden = expanded;
        });
    });

    // Scroll
    resultat.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

/* â”€â”€ Reset â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function resetForm() {
    form.reset();
    counterBadge.textContent = '0';
    counterBadge.classList.remove('has-items');
    intensityVal.textContent = '5';
    intensitySlider.value = '5';
    resultat.innerHTML = '';
    resultat.classList.remove('visible');
    resetBtn.classList.remove('visible');
    validationMsg.classList.remove('visible');
    window.scrollTo({ top: 0, behavior: 'smooth' });
}
</script>
</body>
</html>
